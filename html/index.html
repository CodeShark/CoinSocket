<html>
<head>
<title>CoinSocket Test Client</title>
</head>
<body>
<div>
    Server: <input type="text" id="url" value="ws://test.ciphrex.com:12345" size="50" />
    <input type="button" id="connectbutton" onclick="connect()" value="Connect" />
</div>
<div>
    Examples:
    <select id="examples" onchange="exampleSelected();">
        <option value='{"method":"status"}'>{"method":"status"}</option>
        <option value='{"method":"keychains"}'>{"method":"keychains"}</option>
        <option value='{"method":"listaccounts"}'>{"method":"listaccounts"}'</option>
        <option value='{"method":"bestblockheader"}'>{"method":"bestblockheader"}'</option>
        <option value='{"method":"issuescript","params":["abc1","foo"]}'>{"method":"issuescript","params":["abc1","foo"]}</option>
    </select>
<div>
    Request: <input type="text" id="request" value='{"method":"status"}' size="50" />
    <input type="button" id="sendbutton" onclick="send()" value="Send" disabled  />
</div>
<div>
    <textarea id="output" rows="30" cols="150"></textarea>
</div>
<div>
    <input type="checkbox" id="autoscroll" checked />Autoscroll
</div>
<div>
    <tt><span id="status"></span></tt>
</div>

<!--<script type="text/javascript" src="js/syntaxhighlight.js"></script>-->
<script type="text/javascript">
    var connectbutton; // = document.getElementById('connectbutton');
    var sendbutton; // = document.getElementById('sendbutton');
    var output; // = document.getElementById('output');
    var autoscroll; // = document.getElementById('autoscroll');

    var urlinput; // = document.getElementById('url');

    var exampleselect; // = document.getElementById('examples');
    var requestinput; // = document.getElementById('request');
    var url;

    var ws = null;

    var onopen = function () {
        document.getElementById('status').innerHTML = "Connected to " + url + ".";
        output.value += 'CONNECTED TO ' + url + '.\n\n';
        document.getElementById('connectbutton').value = 'Disconnect';
    };

    var onclose = function () {
        document.getElementById('status').innerHTML = "Connection closed.";
        ws = null;
        connectbutton.value = 'Connect';
        output.value += 'DISCONNECTED FROM ' + url + '.\n';
    };

    var onmessage = function (e) {
        console.log(e.data);
        var json = JSON.stringify(JSON.parse(e.data), undefined, 2);
        output.value += json + '\n';
        if (autoscroll.checked)
            output.scrollTop = output.scrollHeight;
    };

    function connect() {
        if (ws) {
            document.getElementById('sendbutton').disabled = true;
            ws.close();
            return;
        }

        url = urlinput.value;
        document.getElementById('status').innerHTML = "Connecting to " + url + "...";

        ws = new WebSocket(urlinput.value);
        ws.onopen = onopen;
        ws.onclose = onclose;
        ws.onmessage = onmessage;

        document.getElementById('sendbutton').disabled = false;
    }

    function send() {
        if (!ws) return;
        request = requestinput.value;
        document.getElementById('status').innerHTML = "Sending " + request + "...";
        ws.send(request);
        document.getElementById('status').innerHTML = "Sent " + request;
    };

    window.onload = function () {
        connectbutton = document.getElementById('connectbutton');
        output = document.getElementById('output');
        autoscroll = document.getElementById('autoscroll');
        urlinput = document.getElementById('url');
        exampleselect = document.getElementById('examples');
        requestinput = document.getElementById('request');
    };

    function exampleSelected() {
        requestinput.value = exampleselect.options[exampleselect.selectedIndex].value;
    }
</script>
</body>
</html>

